# Xbox Sing-boxç®¡ç†ç³»ç»Ÿ

ä¼ä¸šçº§åˆ†å¸ƒå¼sing-boxèŠ‚ç‚¹ç®¡ç†ç³»ç»Ÿï¼Œæä¾›ç»Ÿä¸€çš„èŠ‚ç‚¹ç®¡ç†ã€é…ç½®ä¸‹å‘ã€ç›‘æ§å‘Šè­¦å’Œè‡ªåŠ¨åŒ–è¿ç»´èƒ½åŠ›ã€‚

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

### èŠ‚ç‚¹ç®¡ç†
- **å¤šèŠ‚ç‚¹ç»Ÿä¸€ç®¡ç†**: æ”¯æŒå¤§è§„æ¨¡sing-boxèŠ‚ç‚¹é›†ç¾¤
- **è‡ªåŠ¨æ³¨å†Œå‘ç°**: Agentè‡ªåŠ¨æ³¨å†Œåˆ°Controller
- **çŠ¶æ€å®æ—¶ç›‘æ§**: èŠ‚ç‚¹åœ¨çº¿çŠ¶æ€ã€èµ„æºä½¿ç”¨ç‡ç›‘æ§
- **æ•…éšœè‡ªåŠ¨æ¢å¤**: æ™ºèƒ½æ•…éšœæ£€æµ‹å’Œè‡ªåŠ¨æ¢å¤æœºåˆ¶

### é…ç½®ç®¡ç†
- **è¿œç¨‹é…ç½®ä¸‹å‘**: ç»Ÿä¸€é…ç½®ç®¡ç†å’Œåˆ†å‘
- **é…ç½®ç‰ˆæœ¬æ§åˆ¶**: æ”¯æŒé…ç½®ç‰ˆæœ¬ç®¡ç†å’Œå›æ»š
- **çƒ­æ›´æ–°**: æ— æœåŠ¡ä¸­æ–­çš„é…ç½®æ›´æ–°
- **é…ç½®éªŒè¯**: è‡ªåŠ¨é…ç½®è¯­æ³•éªŒè¯

### è§„åˆ™ç®¡ç†
- **åŠ¨æ€è§„åˆ™ç®¡ç†**: å®æ—¶æ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤è·¯ç”±è§„åˆ™
- **è§„åˆ™ä¼˜å…ˆçº§**: æ”¯æŒè§„åˆ™ä¼˜å…ˆçº§æ’åº
- **æ‰¹é‡æ“ä½œ**: æ”¯æŒè§„åˆ™æ‰¹é‡å¯¼å…¥å¯¼å‡º
- **è§„åˆ™æ¨¡æ¿**: é¢„å®šä¹‰è§„åˆ™æ¨¡æ¿

### ç›‘æ§å‘Šè­¦
- **å¤šç»´åº¦ç›‘æ§**: ç³»ç»Ÿã€åº”ç”¨ã€ä¸šåŠ¡ä¸‰å±‚ç›‘æ§
- **Prometheusé›†æˆ**: å®Œæ•´çš„æŒ‡æ ‡æ”¶é›†å’Œå­˜å‚¨
- **Grafanaå¯è§†åŒ–**: ä¸°å¯Œçš„ç›‘æ§ä»ªè¡¨æ¿
- **æ™ºèƒ½å‘Šè­¦**: åŸºäºé˜ˆå€¼å’Œè¶‹åŠ¿çš„å‘Šè­¦æœºåˆ¶

### é«˜å¯ç”¨æ€§
- **å®¹å™¨åŒ–éƒ¨ç½²**: Dockerå’ŒDocker Composeæ”¯æŒ
- **å¥åº·æ£€æŸ¥**: å¤šå±‚æ¬¡å¥åº·çŠ¶æ€æ£€æµ‹
- **è‡ªåŠ¨æ¢å¤**: æœåŠ¡å¼‚å¸¸è‡ªåŠ¨é‡å¯å’Œæ¢å¤
- **æ•°æ®å¤‡ä»½**: è‡ªåŠ¨æ•°æ®å¤‡ä»½å’Œæ¢å¤

### ğŸ”’ ä¼ä¸šçº§å®‰å…¨
- **TLS + mTLSåŒå‘è®¤è¯**: æ‰€æœ‰gRPCé€šä¿¡é‡‡ç”¨è¯ä¹¦åŒå‘è®¤è¯
- **ç«¯åˆ°ç«¯åŠ å¯†**: TLS 1.2/1.3 å¼ºåŠ å¯†ä¿æŠ¤æ•°æ®ä¼ è¾“
- **èº«ä»½éªŒè¯**: X.509è¯ä¹¦éªŒè¯é˜²æ­¢éæ³•è®¿é—®
- **å®‰å…¨è¯ä¹¦ç®¡ç†**: PKIè¯ä¹¦åŸºç¡€è®¾æ–½å’Œè‡ªåŠ¨åŒ–å·¥å…·

## ğŸ— ç³»ç»Ÿæ¶æ„

```
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚                    ç›‘æ§å‘Šè­¦å±‚                           â”‚
                            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                            â”‚  â”‚ Prometheus  â”‚  â”‚   Grafana   â”‚  â”‚  AlertManager   â”‚ â”‚
                            â”‚  â”‚   (æŒ‡æ ‡)    â”‚  â”‚   (å¯è§†åŒ–)  â”‚  â”‚     (å‘Šè­¦)      â”‚ â”‚
                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚                     åº”ç”¨å±‚                             â”‚
                            â”‚                                                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” TLS+mTLS â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   RESTful API  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚     Agent       â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚   Controller     â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  External       â”‚ â”‚
â”‚   (sing-box)    â”‚  gRPC+è¯ä¹¦  â”‚  â”‚   (ç®¡ç†ä¸­å¿ƒ)      â”‚                â”‚  Services       â”‚ â”‚
â”‚                 â”‚         â”‚  â”‚                  â”‚                â”‚                 â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”‚ ç›‘æ§æŒ‡æ ‡    â”‚ â”‚         â”‚  â”‚ â”‚ gRPCæœåŠ¡     â”‚ â”‚                                      â”‚
â”‚ â”‚ å¥åº·æ£€æŸ¥    â”‚ â”‚         â”‚  â”‚ â”‚ HTTP API     â”‚ â”‚                                      â”‚
â”‚ â”‚ è‡ªåŠ¨æ¢å¤    â”‚ â”‚         â”‚  â”‚ â”‚ ä¸šåŠ¡é€»è¾‘     â”‚ â”‚                                      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚                    æ•°æ®å­˜å‚¨å±‚                           â”‚
                            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                            â”‚  â”‚    MySQL    â”‚  â”‚    Redis    â”‚  â”‚   File Storage  â”‚ â”‚
                            â”‚  â”‚  (å…³ç³»æ•°æ®)  â”‚  â”‚   (ç¼“å­˜)    â”‚  â”‚    (æ—¥å¿—é…ç½®)   â”‚ â”‚
                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

| ç»„ä»¶ | ç‰ˆæœ¬è¦æ±‚ | è¯´æ˜ |
|------|----------|------|
| Docker | 20.10+ | å®¹å™¨è¿è¡Œæ—¶ |
| Docker Compose | 2.0+ | å®¹å™¨ç¼–æ’ |
| OpenSSL | 1.1.1+ | TLSè¯ä¹¦ç”Ÿæˆ |
| å†…å­˜ | 4GB+ | æ¨èé…ç½® |
| ç£ç›˜ | 10GB+ | æ•°æ®å­˜å‚¨ç©ºé—´ |

### ä¸€é”®éƒ¨ç½²

```bash
# 1. ä¸‹è½½é¡¹ç›®
git clone https://github.com/your-org/xbox.git
cd xbox

# 2. ç”ŸæˆTLSè¯ä¹¦ï¼ˆé¦–æ¬¡éƒ¨ç½²å¿…éœ€ï¼‰
chmod +x scripts/generate_tls_certs.sh
./scripts/generate_tls_certs.sh

# 3. ä¸€é”®å®‰è£…éƒ¨ç½²
chmod +x scripts/deploy.sh
./scripts/deploy.sh install
```

### éªŒè¯éƒ¨ç½²

éƒ¨ç½²å®Œæˆåï¼Œç³»ç»Ÿå°†è‡ªåŠ¨å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼š

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€  
./scripts/deploy.sh status

# éªŒè¯æœåŠ¡å¯ç”¨æ€§
curl http://localhost:8080/api/v1/health    # Controllerå¥åº·æ£€æŸ¥
curl http://localhost:8081/health           # Agentå¥åº·æ£€æŸ¥

# éªŒè¯TLSè¯ä¹¦é…ç½®
./simple_tls_test.sh                        # TLSé…ç½®éªŒè¯
```

### è®¿é—®ç³»ç»Ÿ

| æœåŠ¡ | åœ°å€ | ç”¨é€” | è®¤è¯ |
|------|------|------|------|
| Controller API | http://localhost:8080 | ç®¡ç†æ¥å£ | - |
| Agent API | http://localhost:8081 | ä»£ç†æ¥å£ | - |
| Prometheus | http://localhost:9000 | ç›‘æ§æŒ‡æ ‡ | - |  
| Grafana | http://localhost:3000 | å¯è§†åŒ–é¢æ¿ | admin/xbox123456 |

### å¼€å‘ç¯å¢ƒæ­å»º

å¦‚éœ€è¿›è¡Œå¼€å‘ï¼Œå¯ä»¥æŒ‰ä»¥ä¸‹æ­¥éª¤æ­å»ºå¼€å‘ç¯å¢ƒï¼š

```bash
# 1. å®‰è£…Goç¯å¢ƒ
# Go 1.21+

# 2. å®‰è£…ä¾èµ–
go mod tidy

# 3. ç”Ÿæˆåè®®æ–‡ä»¶
make proto

# 4. æ„å»ºåº”ç”¨
make build

# 5. æœ¬åœ°è¿è¡Œ
make run-controller  # å¯åŠ¨Controller
make run-agent      # å¯åŠ¨Agent
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
xbox/
â”œâ”€â”€ cmd/                           # åº”ç”¨å…¥å£ç‚¹
â”‚   â”œâ”€â”€ agent/main.go             #   Agentå¯åŠ¨ç¨‹åº
â”‚   â””â”€â”€ controller/main.go        #   Controllerå¯åŠ¨ç¨‹åº
â”œâ”€â”€ internal/                      # å†…éƒ¨ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ agent/                    #   Agentæ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ grpc/client.go        #     gRPCå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ monitor/system.go     #     ç³»ç»Ÿç›‘æ§
â”‚   â”‚   â””â”€â”€ singbox/manager.go    #     sing-boxç®¡ç†
â”‚   â”œâ”€â”€ controller/               #   Controlleræ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ grpc/                 #     gRPCæœåŠ¡ç«¯
â”‚   â”‚   â”œâ”€â”€ service/              #     ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â””â”€â”€ repository/           #     æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ config/config.go          #   é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ database/database.go      #   æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ health/health.go          #   å¥åº·æ£€æŸ¥
â”‚   â”œâ”€â”€ monitoring/               #   ç›‘æ§æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ prometheus.go         #     PrometheusæŒ‡æ ‡
â”‚   â”‚   â””â”€â”€ metrics.go            #     æŒ‡æ ‡æ”¶é›†
â”‚   â”œâ”€â”€ recovery/recovery.go      #   æ•…éšœæ¢å¤
â”‚   â”œâ”€â”€ debug/debug.go           #   è°ƒè¯•å·¥å…·
â”‚   â””â”€â”€ models/models.go         #   æ•°æ®æ¨¡å‹
â”œâ”€â”€ pkg/                          # å…±äº«å·¥å…·åŒ…
â”‚   â””â”€â”€ logger/logger.go         #   æ—¥å¿—å·¥å…·
â”œâ”€â”€ proto/                        # gRPCåè®®å®šä¹‰
â”‚   â””â”€â”€ agent.proto              #   AgentæœåŠ¡åè®®
â”œâ”€â”€ api/                          # RESTful APIå®šä¹‰
â”œâ”€â”€ configs/                      # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ config.yaml              #   Controlleré…ç½®
â”‚   â”œâ”€â”€ agent.yaml               #   Agenté…ç½®
â”‚   â””â”€â”€ sing-box.json            #   sing-boxé…ç½®æ¨¡æ¿
â”œâ”€â”€ certs/                        # TLSè¯ä¹¦ç›®å½•
â”‚   â”œâ”€â”€ ca/ca-cert.pem           #   CAæ ¹è¯ä¹¦
â”‚   â”œâ”€â”€ server/server-cert.pem   #   ControlleræœåŠ¡å™¨è¯ä¹¦
â”‚   â””â”€â”€ client/client-cert.pem   #   Agentå®¢æˆ·ç«¯è¯ä¹¦
â”œâ”€â”€ scripts/                      # éƒ¨ç½²å’Œå·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ deploy.sh                #   ä¸€é”®éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ generate_tls_certs.sh    #   TLSè¯ä¹¦ç”Ÿæˆè„šæœ¬
â”‚   â””â”€â”€ init.sql                 #   æ•°æ®åº“åˆå§‹åŒ–
â”œâ”€â”€ monitoring/                   # ç›‘æ§é…ç½®
â”‚   â””â”€â”€ prometheus.yml           #   Prometheusé…ç½®
â”œâ”€â”€ docs/                         # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ development-plan.md      #   å¼€å‘è®¡åˆ’
â”‚   â””â”€â”€ api/                     #   APIæ–‡æ¡£
â”œâ”€â”€ Dockerfile.controller         # Controlleré•œåƒ
â”œâ”€â”€ Dockerfile.agent             # Agenté•œåƒ
â”œâ”€â”€ docker-compose.yml           # å®¹å™¨ç¼–æ’
â””â”€â”€ README.md                    # é¡¹ç›®è¯´æ˜
```

## ğŸ“– ä½¿ç”¨æŒ‡å—

### æœåŠ¡ç®¡ç†

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
./scripts/deploy.sh start

# åœæ­¢æ‰€æœ‰æœåŠ¡  
./scripts/deploy.sh stop

# é‡å¯æ‰€æœ‰æœåŠ¡
./scripts/deploy.sh restart

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./scripts/deploy.sh status

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
./scripts/deploy.sh logs [service_name]
```

### ç›‘æ§å’Œè°ƒè¯•

```bash
# æŸ¥çœ‹ç³»ç»Ÿå¥åº·çŠ¶æ€
curl http://localhost:8080/api/v1/health
curl http://localhost:8081/health

# æŸ¥çœ‹PrometheusæŒ‡æ ‡
curl http://localhost:8080/metrics
curl http://localhost:8081/metrics

# æŸ¥çœ‹è¿è¡Œæ—¶ä¿¡æ¯
curl http://localhost:8080/debug/runtime
curl http://localhost:8081/debug/runtime

# æ€§èƒ½åˆ†æ
curl http://localhost:8080/debug/pprof/
curl http://localhost:8081/debug/pprof/
```

### æ•°æ®å¤‡ä»½å’Œæ¢å¤

```bash
# åˆ›å»ºæ•°æ®å¤‡ä»½
./scripts/deploy.sh backup

# æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶
ls -la backups/

# æ¢å¤æ•°æ®ï¼ˆéœ€è¦å…ˆåœæ­¢æœåŠ¡ï¼‰
./scripts/deploy.sh stop
# æ‰‹åŠ¨æ¢å¤æ•°æ®åº“å’Œé…ç½®æ–‡ä»¶
./scripts/deploy.sh start
```

## ğŸ”§ è¿ç»´ç®¡ç†

### æ—¥å¿—ç®¡ç†

ç³»ç»Ÿé‡‡ç”¨ç»“æ„åŒ–æ—¥å¿—ï¼Œæ”¯æŒæ—¥å¿—è½®è½¬å’Œå‹ç¼©ï¼š

- **æ—¥å¿—ä½ç½®**: `./logs/` ç›®å½•
- **æ—¥å¿—æ ¼å¼**: JSONæ ¼å¼ï¼Œä¾¿äºæœç´¢åˆ†æ
- **è½®è½¬ç­–ç•¥**: å•æ–‡ä»¶100MBï¼Œä¿ç•™10ä¸ªå¤‡ä»½
- **ä¿ç•™æœŸé™**: 30å¤©è‡ªåŠ¨æ¸…ç†

### ç›‘æ§æŒ‡æ ‡

ç³»ç»Ÿæä¾›ä¸°å¯Œçš„ç›‘æ§æŒ‡æ ‡ï¼š

#### ç³»ç»ŸæŒ‡æ ‡
- `xbox_system_cpu_usage_percent` - CPUä½¿ç”¨ç‡
- `xbox_system_memory_usage_bytes` - å†…å­˜ä½¿ç”¨é‡  
- `xbox_system_disk_usage_percent` - ç£ç›˜ä½¿ç”¨ç‡

#### åº”ç”¨æŒ‡æ ‡
- `xbox_agent_status` - Agentåœ¨çº¿çŠ¶æ€
- `xbox_agent_heartbeat_total` - å¿ƒè·³æ€»æ•°
- `xbox_singbox_status` - sing-boxè¿è¡ŒçŠ¶æ€
- `xbox_singbox_connections_active` - æ´»è·ƒè¿æ¥æ•°

#### ä¸šåŠ¡æŒ‡æ ‡
- `xbox_config_updates_total` - é…ç½®æ›´æ–°æ¬¡æ•°
- `xbox_rule_updates_total` - è§„åˆ™æ›´æ–°æ¬¡æ•°
- `xbox_errors_total` - é”™è¯¯ç»Ÿè®¡

### å‘Šè­¦é…ç½®

ç³»ç»Ÿé¢„é…ç½®äº†ä»¥ä¸‹å‘Šè­¦è§„åˆ™ï¼š

- **Agentç¦»çº¿å‘Šè­¦**: Agentè¶…è¿‡1åˆ†é’Ÿæœªå¿ƒè·³
- **CPUä½¿ç”¨ç‡å‘Šè­¦**: CPUä½¿ç”¨ç‡è¶…è¿‡80%æŒç»­5åˆ†é’Ÿ  
- **å†…å­˜ä½¿ç”¨ç‡å‘Šè­¦**: å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡90%æŒç»­5åˆ†é’Ÿ
- **sing-boxå¼‚å¸¸å‘Šè­¦**: sing-boxè¿›ç¨‹åœæ­¢è¿è¡Œ

## ğŸ”— APIæ–‡æ¡£

### Controller API

#### èŠ‚ç‚¹ç®¡ç†
- `GET /api/v1/agents` - è·å–èŠ‚ç‚¹åˆ—è¡¨
- `GET /api/v1/agents/{id}` - è·å–èŠ‚ç‚¹è¯¦æƒ…  
- `PUT /api/v1/agents/{id}` - æ›´æ–°èŠ‚ç‚¹ä¿¡æ¯
- `DELETE /api/v1/agents/{id}` - åˆ é™¤èŠ‚ç‚¹

#### é…ç½®ç®¡ç†  
- `POST /api/v1/configs` - åˆ›å»ºé…ç½®
- `GET /api/v1/configs/{agent_id}` - è·å–èŠ‚ç‚¹é…ç½®
- `PUT /api/v1/configs/{id}` - æ›´æ–°é…ç½®
- `DELETE /api/v1/configs/{id}` - åˆ é™¤é…ç½®

#### è§„åˆ™ç®¡ç†
- `POST /api/v1/rules` - åˆ›å»ºè§„åˆ™
- `GET /api/v1/rules` - è·å–è§„åˆ™åˆ—è¡¨
- `PUT /api/v1/rules/{id}` - æ›´æ–°è§„åˆ™  
- `DELETE /api/v1/rules/{id}` - åˆ é™¤è§„åˆ™

#### ç³»ç»Ÿæ¥å£
- `GET /api/v1/health` - å¥åº·æ£€æŸ¥
- `GET /api/v1/ready` - å°±ç»ªæ£€æŸ¥
- `GET /metrics` - PrometheusæŒ‡æ ‡
- `GET /debug/runtime` - è¿è¡Œæ—¶ä¿¡æ¯

### Agent API

- `GET /health` - å¥åº·æ£€æŸ¥
- `GET /live` - å­˜æ´»æ£€æŸ¥
- `GET /metrics` - PrometheusæŒ‡æ ‡
- `GET /debug/runtime` - è¿è¡Œæ—¶ä¿¡æ¯
- `GET /debug/pprof/` - æ€§èƒ½åˆ†æ

## âš ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥DockerçŠ¶æ€
docker --version
docker-compose --version

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep -E ':(8080|8081|9000|3000|3306)'

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
./scripts/deploy.sh logs
```

#### 2. Agentæ— æ³•è¿æ¥Controller
```bash
# æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
docker-compose exec agent ping controller

# æ£€æŸ¥gRPCç«¯å£
docker-compose exec agent telnet controller 9090

# æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
systemctl status firewalld
```

#### 3. æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
docker-compose exec mysql mysqladmin ping -u root -pxbox123456

# é‡å¯æ•°æ®åº“
docker-compose restart mysql

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker-compose logs mysql
```

#### 4. ç›‘æ§æ•°æ®å¼‚å¸¸
```bash
# æ£€æŸ¥Prometheusè¿æ¥
curl http://localhost:9000/api/v1/targets

# æ£€æŸ¥æŒ‡æ ‡ç«¯ç‚¹
curl http://localhost:8080/metrics
curl http://localhost:8081/metrics

# é‡å¯ç›‘æ§æœåŠ¡
docker-compose restart prometheus grafana
```

### æ€§èƒ½ä¼˜åŒ–

#### ç³»ç»Ÿçº§ä¼˜åŒ–
- è°ƒæ•´Dockerå†…å­˜é™åˆ¶
- ä¼˜åŒ–æ•°æ®åº“è¿æ¥æ± é…ç½®
- å¯ç”¨Redisç¼“å­˜
- é…ç½®è´Ÿè½½å‡è¡¡

#### åº”ç”¨çº§ä¼˜åŒ–
- è°ƒæ•´å¿ƒè·³é—´éš”
- ä¼˜åŒ–ç›‘æ§æ•°æ®æ”¶é›†é¢‘ç‡
- é…ç½®æ—¥å¿—è½®è½¬ç­–ç•¥
- å¯ç”¨gRPCè¿æ¥å¤ç”¨

### ğŸ”’ å®‰å…¨æ¶æ„

#### TLS + mTLSåŒå‘è®¤è¯
- **ç«¯åˆ°ç«¯åŠ å¯†**: æ‰€æœ‰gRPCé€šä¿¡é‡‡ç”¨TLS 1.2/1.3åŠ å¯†
- **åŒå‘èº«ä»½éªŒè¯**: Controllerå’ŒAgentä½¿ç”¨X.509è¯ä¹¦ç›¸äº’è®¤è¯
- **è¯ä¹¦ç®¡ç†**: PKIåŸºç¡€è®¾æ–½ï¼Œæ”¯æŒè¯ä¹¦ç”Ÿæˆã€éªŒè¯å’Œè½®æ¢
- **é˜²ä¸­é—´äººæ”»å‡»**: é€šè¿‡è¯ä¹¦é“¾éªŒè¯å’Œä¸»æœºåæ£€æŸ¥

#### è¯ä¹¦åŸºç¡€è®¾æ–½
```bash
# ç”Ÿæˆè¯ä¹¦åŸºç¡€è®¾æ–½
./scripts/generate_tls_certs.sh

# éªŒè¯TLSé…ç½®
./simple_tls_test.sh

# æµ‹è¯•mTLSè®¤è¯
./test_mtls_authentication.sh
```

#### å®‰å…¨ç‰¹æ€§
- **ç½‘ç»œéš”ç¦»**: Dockerå†…éƒ¨ç½‘ç»œ + TLSåŠ å¯†
- **èº«ä»½éªŒè¯**: åŸºäºè¯ä¹¦çš„å¼ºèº«ä»½è®¤è¯
- **è®¿é—®æ§åˆ¶**: åªå…è®¸æœ‰æ•ˆè¯ä¹¦çš„è¿æ¥
- **æ•°æ®ä¿æŠ¤**: ä¼ è¾“ä¸­æ•°æ®å…¨ç¨‹åŠ å¯†
- **å®¡è®¡èƒ½åŠ›**: è¯ä¹¦å’Œè¿æ¥äº‹ä»¶æ—¥å¿—
- **æƒé™ç®¡ç†**: æœ€å°æƒé™åŸåˆ™

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿ä¸ºé¡¹ç›®è´¡çŒ®ä»£ç ï¼

### å¼€å‘æµç¨‹
1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤ä»£ç æ›´æ”¹
4. é€šè¿‡æµ‹è¯•
5. æäº¤Pull Request

### ä»£ç è§„èŒƒ
- éµå¾ªGoä»£ç è§„èŒƒ
- æ·»åŠ å•å…ƒæµ‹è¯•
- æ›´æ–°æ–‡æ¡£
- æ·»åŠ å˜æ›´æ—¥å¿—

### æäº¤è§„èŒƒ
```
feat: æ·»åŠ æ–°åŠŸèƒ½
fix: ä¿®å¤bug
docs: æ›´æ–°æ–‡æ¡£  
style: ä»£ç æ ¼å¼è°ƒæ•´
refactor: ä»£ç é‡æ„
test: æ·»åŠ æµ‹è¯•
chore: æ„å»ºå·¥å…·å˜æ›´
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è·å–å¸®åŠ©
- ğŸ“– [é¡¹ç›®æ–‡æ¡£](docs/)
- ğŸ› [é—®é¢˜åé¦ˆ](https://github.com/your-org/xbox/issues)
- ğŸ’¬ [è®¨è®ºåŒº](https://github.com/your-org/xbox/discussions)

### è”ç³»æ–¹å¼
- é‚®ç®±: support@your-org.com
- æ–‡æ¡£: [å®Œæ•´æ–‡æ¡£ç«™ç‚¹](https://docs.your-org.com/xbox)

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº [MIT License](LICENSE) å¼€æºåè®®ã€‚

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š
- [sing-box](https://github.com/SagerNet/sing-box) - é€šç”¨ä»£ç†å¹³å°
- [Prometheus](https://prometheus.io/) - ç›‘æ§å‘Šè­¦ç³»ç»Ÿ
- [Grafana](https://grafana.com/) - å¯è§†åŒ–å¹³å°
- [gRPC](https://grpc.io/) - é«˜æ€§èƒ½RPCæ¡†æ¶

---

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ªæ˜Ÿæ ‡ï¼